# Product Requirements Document: At-Bat Loop Simulator

**Document ID:** PRD-20251024-02
**Feature Name:** At-Bat Loop (K, BB, Ball-In-Play)
**Created:** 2025-10-24
**Status:** Draft
**Priority:** High

---

## 1. Executive Summary

This PRD defines the requirements for adding a complete at-bat simulator to the DiamondSim baseball simulator. The feature will implement a pitch-by-pitch loop that continues until a terminal outcome is reached: **Strikeout (K)**, **Walk (BB)**, or **Ball-In-Play (BIP)**. This builds upon the count-conditioned contact system implemented in Part 1.

### Key Benefits
- **Complete At-Bat Simulation:** Models the full progression from first pitch to terminal outcome
- **Realistic Pitch Outcomes:** Implements zone/out-of-zone decisions, swing/take decisions, and foul ball handling
- **Statistical Validation:** Produces K%, BB%, and BIP% distributions that match expected baseball outcomes
- **Foundation for Game Simulation:** Provides the core building block for simulating complete games

---

## 2. Background & Context

### Current State
The DiamondSim project currently has:
- Count-conditioned contact probability (Part 1, completed)
- [`GameState`](src/DiamondSim/GameState.cs) class for tracking balls and strikes
- [`Probabilities.CountContactAdjust()`](src/DiamondSim/Probabilities.cs) for count-based adjustments
- Contact rate validation between 0.70 and 0.85 for neutral counts

### Problem Statement
The simulator can currently evaluate contact probability for a single pitch given a count, but it cannot:
- Simulate a complete at-bat from start to finish
- Determine whether a pitch is in the strike zone or out of zone
- Model batter swing/take decisions based on pitch location
- Handle foul balls correctly (not adding a third strike)
- Produce terminal outcomes (K, BB, BIP) with realistic distributions

### Baseball Context
In real baseball, an at-bat progresses through multiple pitches:
1. **Pitch Location:** Pitcher throws in zone or out of zone (based on Control)
2. **Batter Decision:** Batter swings or takes (based on Patience and location)
3. **Pitch Outcome:** Ball, called strike, swing-and-miss, foul, or in-play
4. **Count Update:** Balls and strikes are updated (fouls don't add third strike)
5. **Terminal Check:** Continue loop or end with K/BB/BIP

For average vs. average matchups, expected distributions are approximately:
- **K%:** 18-28%
- **BB%:** 7-12%
- **BIP%:** 55-70%

---

## 3. Goals & Objectives

### Primary Goals
1. Implement pitch-level outcome enumeration and at-bat terminal states
2. Create an at-bat simulator that loops pitch-by-pitch until terminal outcome
3. Model zone/out-of-zone decisions using pitcher Control
4. Model swing/take decisions using batter Patience
5. Validate that K%, BB%, and BIP% fall within expected ranges

### Success Metrics
- All existing tests remain green (no regression)
- New tests demonstrate K%, BB%, and BIP% within target ranges
- Distributions sum to 100% (all at-bats reach terminal state)
- Tests are deterministic using seeded RNG

### Non-Goals (Out of Scope)
- Specific pitch types (fastball, curveball, etc.)
- Pitch velocity or movement
- Umpire strike zone variations
- Batter/pitcher fatigue
- Situational hitting (runners on base, score, etc.)
- Individual player tendencies beyond Control and Patience

---

## 4. Functional Requirements

### FR-1: Pitch Outcome Enumeration
**Priority:** P0 (Critical)

**Description:** Define an enumeration for all possible pitch-level outcomes.

**Requirements:**
- FR-1.1: Create a new file [`Outcomes.cs`](src/DiamondSim/Outcomes.cs) in `src/DiamondSim/`
- FR-1.2: Define `PitchOutcome` enum with values:
  - `Ball` - Pitch out of zone, batter takes
  - `CalledStrike` - Pitch in zone, batter takes
  - `SwingAndMiss` - Batter swings, misses
  - `Foul` - Batter makes contact, foul ball
  - `InPlay` - Batter makes contact, ball in play
- FR-1.3: Define `AtBatTerminal` enum with values:
  - `Strikeout` - Three strikes
  - `Walk` - Four balls
  - `BallInPlay` - Contact made, ball in play
- FR-1.4: Define `AtBatResult` record containing:
  - `Terminal` (AtBatTerminal) - The terminal outcome
  - `FinalCount` (string or tuple) - Final balls-strikes count
  - `PitchCount` (int) - Number of pitches in the at-bat

**Acceptance Criteria:**
- Enums are properly defined with XML documentation
- `AtBatResult` record is immutable and well-documented
- All outcome types are represented

---

### FR-2: At-Bat Simulator Implementation
**Priority:** P0 (Critical)

**Description:** Implement a simulator that loops pitch-by-pitch until reaching a terminal outcome.

**Requirements:**
- FR-2.1: Create a new file [`AtBatSimulator.cs`](src/DiamondSim/AtBatSimulator.cs) in `src/DiamondSim/`
- FR-2.2: Implement `SimulateAtBat()` method that:
  - Accepts pitcher and batter parameters (Control, Patience, Contact, Power)
  - Initializes a [`GameState`](src/DiamondSim/GameState.cs) at 0-0 count
  - Loops until terminal outcome is reached
  - Returns an `AtBatResult`
- FR-2.3: For each pitch iteration:
  - **Zone Decision:** Use pitcher Control to determine if pitch is in zone or out of zone
    - Higher Control = more pitches in zone
    - Suggested: 60-75% in-zone rate for average Control
  - **Swing Decision:** Use batter Patience to determine if batter swings
    - In-zone pitches: High swing rate (e.g., 70-85%)
    - Out-of-zone pitches: Lower swing rate based on Patience (e.g., 20-40% for average)
    - Lower Patience = higher chase rate on out-of-zone pitches
  - **Contact Decision:** If swing, use existing contact logic with [`Probabilities.CountContactAdjust()`](src/DiamondSim/Probabilities.cs)
  - **Outcome Determination:**
    - No swing + in zone = `CalledStrike`
    - No swing + out of zone = `Ball`
    - Swing + no contact = `SwingAndMiss`
    - Swing + contact = `Foul` or `InPlay` (based on additional logic)
  - **Count Update:** Update [`GameState`](src/DiamondSim/GameState.cs) based on outcome
    - `Ball`: increment balls
    - `CalledStrike`, `SwingAndMiss`: increment strikes
    - `Foul`: increment strikes (but not to 3)
    - `InPlay`: terminal outcome
  - **Terminal Check:** Check for 3 strikes (K), 4 balls (BB), or InPlay (BIP)
- FR-2.4: Ensure deterministic behavior with seeded RNG

**Acceptance Criteria:**
- Simulator completes all at-bats with a terminal outcome
- No infinite loops or stuck states
- Count updates correctly for all pitch outcomes
- Foul balls do not create a third strike
- Results are deterministic with seeded RNG

---

### FR-3: Foul Ball Handling
**Priority:** P0 (Critical)

**Description:** Implement correct foul ball logic that prevents fouls from creating a third strike.

**Requirements:**
- FR-3.1: When contact is made and outcome is `Foul`:
  - If strikes < 2: increment strikes
  - If strikes == 2: do not increment strikes (count remains at 2 strikes)
- FR-3.2: Determine foul vs. in-play based on contact quality or random chance
  - Suggested: 50-70% of contact results in foul balls (especially with 2 strikes)
  - Remaining contact results in `InPlay`

**Acceptance Criteria:**
- Foul balls never result in strikeouts
- At-bats with 2 strikes can continue indefinitely with fouls
- Foul rate is realistic and tunable

---

### FR-4: Distribution Validation Tests
**Priority:** P0 (Critical)

**Description:** Create comprehensive tests to validate K%, BB%, and BIP% distributions.

**Requirements:**
- FR-4.1: Create a new test file [`AtBatLoopTests.cs`](tests/DiamondSim.Tests/AtBatLoopTests.cs) in `tests/DiamondSim.Tests/`
- FR-4.2: Implement test: `AtBatOutcomes_AverageVsAverage_ProducesRealisticDistributions()`
  - Simulate 10,000 at-bats with average pitcher vs. average batter
  - Count outcomes: strikeouts, walks, balls in play
  - Calculate percentages: K%, BB%, BIP%
  - Assert ranges:
    - K%: 0.18 to 0.28 (18-28%)
    - BB%: 0.07 to 0.12 (7-12%)
    - BIP%: 0.55 to 0.70 (55-70%)
  - Assert sum: K% + BB% + BIP% = 1.00 (100%)
- FR-4.3: Use `SeededRandom` with fixed seed for determinism
- FR-4.4: Document expected ranges and rationale in test comments
- FR-4.5: Additional tests for edge cases:
  - High Control pitcher (lower BB%)
  - High Patience batter (higher BB%, lower K%)
  - Low Contact batter (higher K%)

**Acceptance Criteria:**
- Tests pass consistently with seeded RNG
- Distributions fall within expected ranges
- Percentages sum to 100%
- Tests clearly document assumptions and tolerances

---

## 5. Technical Design

### 5.1 Architecture Overview

```
┌─────────────────────┐
│  AtBatSimulator     │
│                     │
│  SimulateAtBat()    │
│    ↓                │
│  [Loop until        │
│   terminal]         │
│    ↓                │
│  1. Zone decision   │◄─── Pitcher Control
│  2. Swing decision  │◄─── Batter Patience
│  3. Contact check   │◄─── CountContactAdjust()
│  4. Outcome         │
│  5. Update count    │◄─── GameState
│  6. Terminal check  │
└─────────────────────┘
         │
         │ Returns
         ▼
┌─────────────────────┐
│   AtBatResult       │
│                     │
│  Terminal: K/BB/BIP │
│  FinalCount: string │
│  PitchCount: int    │
└─────────────────────┘
```

### 5.2 File Changes

#### New Files
1. **[`src/DiamondSim/Outcomes.cs`](src/DiamondSim/Outcomes.cs)**
   - Purpose: Define pitch outcomes and at-bat terminal states
   - Key types: `PitchOutcome` enum, `AtBatTerminal` enum, `AtBatResult` record

2. **[`src/DiamondSim/AtBatSimulator.cs`](src/DiamondSim/AtBatSimulator.cs)**
   - Purpose: Implement pitch-by-pitch at-bat simulation loop
   - Key method: `SimulateAtBat()`
   - Dependencies: [`GameState`](src/DiamondSim/GameState.cs), [`Probabilities`](src/DiamondSim/Probabilities.cs), [`GameEngine`](src/DiamondSim/GameEngine.cs)

3. **[`tests/DiamondSim.Tests/AtBatLoopTests.cs`](tests/DiamondSim.Tests/AtBatLoopTests.cs)**
   - Purpose: Validate at-bat distributions and terminal outcomes
   - Key test: Distribution validation with 10,000 trials

#### Modified Files
- **[`src/DiamondSim/GameState.cs`](src/DiamondSim/GameState.cs)** (potentially)
  - May need methods to check for terminal states (IsWalk, IsStrikeout)
  - May need method to safely increment strikes (respecting foul ball rule)

### 5.3 Probability Knobs & Tuning

The following parameters control the simulation and can be tuned to achieve target distributions:

1. **Zone Rate (Pitcher Control)**
   - Base in-zone rate: 60-75% for average Control
   - Higher Control → more strikes, fewer walks
   - Lower Control → more balls, more walks

2. **Swing Rate**
   - In-zone swing rate: 70-85% (aggressive on strikes)
   - Out-of-zone swing rate: 20-40% for average Patience
   - Lower Patience → higher chase rate → more strikeouts

3. **Contact Rate**
   - Uses existing [`Probabilities.CountContactAdjust()`](src/DiamondSim/Probabilities.cs)
   - Already validated in Part 1 (0.70-0.85 range)

4. **Foul Rate**
   - Percentage of contact that results in fouls: 50-70%
   - Higher with 2 strikes (protective swing)
   - Remaining contact results in BIP

### 5.4 State Transition Diagram

```
        [0-0]
          ↓
    ┌─────────────┐
    │  Pitch Loop │
    └─────────────┘
          ↓
    Zone Decision
    ↙         ↘
  In Zone   Out of Zone
    ↓            ↓
Swing Decision  Swing Decision
  ↙    ↘         ↙    ↘
Swing  Take   Swing  Take
  ↓      ↓      ↓      ↓
Contact? Called Swing? Ball
  ↓      Strike   ↓
Yes/No           Yes/No
  ↓                ↓
Foul/InPlay    SwingAndMiss
  ↓                ↓
Update Count   Update Count
  ↓                ↓
Terminal?      Terminal?
  ↓                ↓
Yes → Return Result
No  → Loop
```

### 5.5 Implementation Approach

**Phase 1: Foundation**
1. Create [`Outcomes.cs`](src/DiamondSim/Outcomes.cs) with enums and record
2. Add helper methods to [`GameState`](src/DiamondSim/GameState.cs) if needed

**Phase 2: Core Simulator**
3. Create [`AtBatSimulator.cs`](src/DiamondSim/AtBatSimulator.cs)
4. Implement zone decision logic (Control-based)
5. Implement swing decision logic (Patience-based)
6. Integrate contact logic from Part 1
7. Implement foul ball handling
8. Implement count updates and terminal checks

**Phase 3: Validation**
9. Create [`AtBatLoopTests.cs`](tests/DiamondSim.Tests/AtBatLoopTests.cs)
10. Run 10,000 trial test with seeded RNG
11. Tune probability knobs to achieve target distributions
12. Verify all existing tests still pass

---

## 6. Acceptance Criteria

### AC-1: Backward Compatibility
- ✅ All existing tests in [`AtBatTests.cs`](tests/DiamondSim.Tests/AtBatTests.cs) pass without modification
- ✅ All existing tests in [`CountContactTests.cs`](tests/DiamondSim.Tests/CountContactTests.cs) pass without modification
- ✅ No changes to existing public APIs

### AC-2: At-Bat Completion
- ✅ All simulated at-bats reach a terminal outcome (no infinite loops)
- ✅ Terminal outcomes are one of: Strikeout, Walk, or BallInPlay
- ✅ `AtBatResult` contains accurate final count and pitch count

### AC-3: Distribution Targets (Average vs. Average, 10,000 trials)
- ✅ Strikeout rate (K%): 18-28%
- ✅ Walk rate (BB%): 7-12%
- ✅ Ball-in-play rate (BIP%): 55-70%
- ✅ Sum of percentages: 100% (all at-bats accounted for)

### AC-4: Foul Ball Handling
- ✅ Foul balls increment strikes when strikes < 2
- ✅ Foul balls do not increment strikes when strikes = 2
- ✅ At-bats can continue indefinitely with fouls at 2 strikes

### AC-5: Deterministic Testing
- ✅ Tests use `SeededRandom` with fixed seed
- ✅ Tests pass consistently across multiple runs
- ✅ No flaky test failures due to randomness

### AC-6: Code Quality
- ✅ New code follows `.rules/style.md` (K&R braces, file-scoped namespaces)
- ✅ Tests follow `.rules/testing.md` (NUnit, deterministic)
- ✅ XML documentation comments for public APIs
- ✅ No compiler warnings or errors

---

## 7. Testing Strategy

### 7.1 Unit Tests
- **Outcome enums:** Verify all values are defined correctly
- **AtBatResult record:** Verify immutability and properties
- **GameState helpers:** Test terminal state checks and count updates

### 7.2 Integration Tests (Primary Validation)
- **Distribution test:** [`AtBatLoopTests.cs`](tests/DiamondSim.Tests/AtBatLoopTests.cs)
  - Sample size: 10,000 at-bats
  - Seeded RNG: Fixed seed for reproducibility
  - Assertions: K%, BB%, BIP% within target ranges
  - Assertion: Sum = 100%
  - Test name: `AtBatOutcomes_AverageVsAverage_ProducesRealisticDistributions()`

### 7.3 Edge Case Tests
- **High Control pitcher:** Lower BB%, verify K% and BIP% adjust accordingly
- **High Patience batter:** Higher BB%, lower K%, verify BIP% adjusts
- **Low Contact batter:** Higher K%, verify BB% and BIP% adjust
- **Extreme counts:** Verify correct handling of 3-0, 0-2, 3-2 counts
- **Foul ball marathon:** Verify at-bats with many fouls at 2 strikes eventually terminate

### 7.4 Regression Tests
- **Existing test suites:** All tests in [`AtBatTests.cs`](tests/DiamondSim.Tests/AtBatTests.cs) and [`CountContactTests.cs`](tests/DiamondSim.Tests/CountContactTests.cs) must pass
- **No API changes:** Existing code using current APIs continues to work

---

## 8. Risks & Mitigation

### Risk 1: Distribution Tuning Difficulty
**Description:** Achieving target K%, BB%, and BIP% ranges may require significant tuning of probability knobs.

**Likelihood:** High
**Impact:** Medium

**Mitigation:**
- Start with research-based or data-driven initial values
- Document all probability knobs clearly
- Make knobs easily adjustable (constants at top of file)
- Use iterative approach: run tests, adjust knobs, repeat
- Consider making knobs configurable via parameters
- Document the tuning process and final values

---

### Risk 2: Infinite Loop or Stuck States
**Description:** Logic errors could cause at-bats to never terminate.

**Likelihood:** Low
**Impact:** High

**Mitigation:**
- Implement maximum pitch count safety check (e.g., 50 pitches)
- Add comprehensive logging during development
- Test edge cases thoroughly (especially foul ball handling)
- Code review focusing on loop termination conditions
- Add assertions to verify terminal state is always reached

---

### Risk 3: Foul Ball Logic Complexity
**Description:** Correctly handling fouls (especially with 2 strikes) adds complexity.

**Likelihood:** Medium
**Impact:** Low

**Mitigation:**
- Implement foul ball logic as a separate, well-tested method
- Add specific unit tests for foul ball count updates
- Document the "no third strike on foul" rule clearly in code
- Test at-bats that generate many fouls at 2 strikes

---

### Risk 4: Test Flakiness
**Description:** Stochastic simulations may produce inconsistent results.

**Likelihood:** Low (with seeded RNG)
**Impact:** Medium

**Mitigation:**
- Use deterministic RNG with fixed seeds (per `.rules/testing.md`)
- Use large sample size (10,000 at-bats) for statistical stability
- Define appropriate tolerance ranges in assertions
- Document expected variance in test comments
- Consider running multiple seeds if needed for robustness

---

### Risk 5: Unrealistic Distributions
**Description:** Initial implementation may produce distributions that don't match real baseball.

**Likelihood:** Medium
**Impact:** Low

**Mitigation:**
- Use conservative initial values based on research
- Accept wide tolerance ranges initially (18-28% for K%)
- Plan for iterative tuning based on test results
- Document assumptions and sources for probability values
- Consider future enhancement to validate against real baseball data

---

## 9. Implementation Notes

### 9.1 Probability Knob Starting Values

Suggested initial values for tuning:

```csharp
// Zone Decision (Pitcher Control)
const double BaseInZoneRate = 0.65; // 65% for average Control
const double ControlAdjustment = 0.10; // ±10% based on Control rating

// Swing Decision (Batter Patience)
const double InZoneSwingRate = 0.75; // 75% swing on strikes
const double OutOfZoneSwingRate = 0.30; // 30% chase for average Patience
const double PatienceAdjustment = 0.15; // ±15% based on Patience rating

// Foul Rate
const double FoulRateWithTwoStrikes = 0.65; // 65% fouls with 2 strikes
const double FoulRateOtherCounts = 0.50; // 50% fouls otherwise
```

These values should be documented and easily adjustable.

### 9.2 GameState Enhancements

Consider adding these helper methods to [`GameState`](src/DiamondSim/GameState.cs):

```csharp
public bool IsWalk() => Balls >= 4;
public bool IsStrikeout() => Strikes >= 3;
public bool IsTerminal() => IsWalk() || IsStrikeout();
public void IncrementBalls() => Balls++;
public void IncrementStrikes() => Strikes++;
public void IncrementStrikesSafe() {
    // Foul ball logic: don't add third strike
    if (Strikes < 2) Strikes++;
}
```

### 9.3 Contact to Foul/InPlay Logic

When contact is made, determine foul vs. in-play:

```csharp
// Pseudo-code
if (contact) {
    double foulRate = (strikes == 2) ? FoulRateWithTwoStrikes : FoulRateOtherCounts;
    if (random.NextDouble() < foulRate) {
        return PitchOutcome.Foul;
    } else {
        return PitchOutcome.InPlay;
    }
}
```

### 9.4 Testing Approach

1. **Start with basic test:** Verify at-bats complete (no infinite loops)
2. **Add distribution test:** Run 10,000 trials, observe actual distributions
3. **Tune knobs iteratively:** Adjust zone rate, swing rate, foul rate
4. **Validate ranges:** Ensure K%, BB%, BIP% fall within targets
5. **Add edge case tests:** High/low Control, Patience, Contact

### 9.5 Code Organization

- Keep [`AtBatSimulator`](src/DiamondSim/AtBatSimulator.cs) focused on the main loop
- Extract helper methods for zone decision, swing decision, outcome determination
- Use clear, descriptive method names (e.g., `DetermineZone()`, `DetermineSwing()`)
- Follow existing project patterns from [`GameEngine`](src/DiamondSim/GameEngine.cs)

---

## 10. Future Enhancements (Out of Scope)

The following features are explicitly out of scope for this PRD but may be considered in future iterations:

1. **Pitch Types:** Fastball, curveball, changeup with different characteristics
2. **Pitch Velocity:** Speed affecting swing decisions and contact
3. **Pitch Movement:** Break affecting zone and contact
4. **Umpire Tendencies:** Variable strike zone based on umpire
5. **Situational Hitting:** Adjustments based on game situation
6. **Pitcher Fatigue:** Declining Control/Stuff over pitches
7. **Batter Adjustments:** Learning pitcher tendencies during at-bat
8. **Pitch Sequencing:** Strategic pitch selection based on count and previous pitches
9. **Advanced Metrics:** Whiff rate, chase rate, zone contact rate
10. **Pitch-by-Pitch Logging:** Detailed record of each pitch in the at-bat

---

## 11. Dependencies

### Internal Dependencies
- [`GameState`](src/DiamondSim/GameState.cs) - Count tracking (from Part 1)
- [`Probabilities.CountContactAdjust()`](src/DiamondSim/Probabilities.cs) - Count-based contact adjustments (from Part 1)
- [`GameEngine`](src/DiamondSim/GameEngine.cs) - Existing simulation infrastructure
- [`Model.cs`](src/DiamondSim/Model.cs) - Player attribute definitions
- [`Random.cs`](src/DiamondSim/Random.cs) - Seeded RNG for determinism

### External Dependencies
- .NET 8 SDK
- NUnit 3.x test framework (per `.rules/testing.md`)
- No new external dependencies required

---

## 12. Documentation Requirements

### Code Documentation
- XML documentation comments for all public APIs
- Inline comments explaining probability knobs and their rationale
- Comments documenting foul ball logic (no third strike rule)
- Example usage in method documentation

### Test Documentation
- Clear test names describing what is being validated
- Comments explaining distribution targets and tolerances
- Documentation of RNG seeding strategy
- Comments explaining probability knob values used in tests

### Tuning Documentation
- Document all probability knobs and their initial values
- Document the tuning process and iterations
- Document final values and rationale
- Provide guidance for future tuning if needed

---

## 13. Success Criteria Summary

This feature will be considered successfully implemented when:

1. ✅ [`Outcomes.cs`](src/DiamondSim/Outcomes.cs) defines all pitch outcomes and at-bat terminals
2. ✅ [`AtBatSimulator.cs`](src/DiamondSim/AtBatSimulator.cs) implements complete at-bat loop
3. ✅ Foul ball logic correctly prevents third strike on fouls
4. ✅ [`AtBatLoopTests.cs`](tests/DiamondSim.Tests/AtBatLoopTests.cs) validates distributions (10,000 trials)
5. ✅ K% falls within 18-28% range
6. ✅ BB% falls within 7-12% range
7. ✅ BIP% falls within 55-70% range
8. ✅ K% + BB% + BIP% = 100%
9. ✅ All existing tests pass without modification
10. ✅ Tests are deterministic using `SeededRandom`
11. ✅ Code follows `.rules/style.md` and `.rules/testing.md`
12. ✅ No compiler warnings or errors

---

## 14. Appendix

### A. At-Bat Outcome Definitions
- **Strikeout (K):** Batter accumulates 3 strikes before 4 balls
- **Walk (BB):** Batter accumulates 4 balls before 3 strikes
- **Ball-In-Play (BIP):** Batter makes contact and ball is put in play

### B. Expected Distribution Ranges (Average vs. Average)
- **K%:** 18-28% (approximately 23% midpoint)
- **BB%:** 7-12% (approximately 9.5% midpoint)
- **BIP%:** 55-70% (approximately 67.5% midpoint)

*Note: These ranges are based on typical MLB statistics for average matchups. Exact ranges will be validated through testing and may be adjusted based on simulation results.*

### C. Pitch Outcome Probabilities (Approximate)

For average Control pitcher vs. average Patience batter:

| Pitch Location | Batter Action | Outcome | Approximate Probability |
|----------------|---------------|---------|------------------------|
| In Zone | Take | Called Strike | ~15-20% |
| In Zone | Swing + Miss | Swing and Miss | ~10-15% |
| In Zone | Swing + Contact | Foul or InPlay | ~45-55% |
| Out of Zone | Take | Ball | ~20-25% |
| Out of Zone | Swing + Miss | Swing and Miss | ~5-10% |
| Out of Zone | Swing + Contact | Foul or InPlay | ~5-10% |

*These are rough estimates and will be refined during implementation and tuning.*

### D. References
- Part 1 PRD: [`.prd/20251024_01_CountConditionedContact.md`](.prd/20251024_01_CountConditionedContact.md)
- Existing test suite: [`tests/DiamondSim.Tests/AtBatTests.cs`](tests/DiamondSim.Tests/AtBatTests.cs)
- Count contact tests: [`tests/DiamondSim.Tests/CountContactTests.cs`](tests/DiamondSim.Tests/CountContactTests.cs)
- Game state: [`src/DiamondSim/GameState.cs`](src/DiamondSim/GameState.cs)
- Probability utilities: [`src/DiamondSim/Probabilities.cs`](src/DiamondSim/Probabilities.cs)
- Game engine: [`src/DiamondSim/GameEngine.cs`](src/DiamondSim/GameEngine.cs)

---

**Document End**
