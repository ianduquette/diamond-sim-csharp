# Generate PRD (do NOT implement code) — Roo Tasking Block

> This file instructs Roo to **produce a Product Requirements Document (.prd)** only.
> **No code, no scaffolds, no class stubs, no CLI project creation.**

## Task
Create a single Markdown **PRD** for the feature **“Single-Game Simulator & Text Report — v1 Simple”** based on the requirements below.

## Deliverable
- **One** Markdown document named: `PRD-GameLoop-v1.md` containing:
  1) Executive Summary
  2) Goals / Non-Goals
  3) User Inputs & CLI Contract
  4) Determinism & RNG Scope
  5) Game Flow (state machine)
  6) Output Shape (report spec)
  7) Validation & Acceptance Criteria
  8) Open Questions (explicitly list any ambiguities)
  9) Risks & Future Work

**Output format:** Markdown text only. Do **not** include code blocks that contain compilable code. Pseudocode/state tables are fine.

## Non-Goals (Important)
- Do **not** generate source code in any language.
- Do **not** create or reference projects, files, or directories.
- Do **not** invent APIs or class designs; keep it product/behavioral.

---

# Source Requirements (authoritative)

## Scope Summary
Run one 9-inning baseball game from a seed and two teams, and produce a clear **text** report only:
- inning line score
- per-plate-appearance play log (no pitch-by-pitch)
- final team totals and **box scores** (batting + pitching)
No JSON, no UI, no advanced options.

## Out of Scope (v1)
- No bullpen changes, fatigue, or injuries
- No extra innings (ties allowed)
- No park effects or weather
- No pitch-by-pitch logging
- No JSON or additional output formats

## Inputs
- **Seed (optional)**: integer. If omitted, game uses a random seed and **prints the chosen seed** in the header for reproducibility.
- **Teams**: two display names only (Home, Away).
- **Lineups**: always **auto-generated** (see below).
- **Designated Hitter**: **Always ON**. Pitchers never bat.

## Auto-Generated Lineups
- Each team gets **nine generic hitters** named `<Team> 1` … `<Team> 9`.
- Order is randomized **once** at game start based on the game seed.
- No positions, substitutions, or role validation.
- The **9th slot** is displayed as DH for readability.
- Pitchers never appear as batters.

## Game Flow (high level)
1. Initialize game: Top 1st, 0–0, bases empty, 0 outs. One starting pitcher per team for the full game.
2. For each half-inning:
   - Resolve plate appearances to terminal results (`K, BB, HBP, InPlayOut, 1B, 2B, 3B, HR, ROE`).
   - Apply scoring with engine rules (RBI attribution fix, walk-off logic, LOB snapshot).
   - Stop the half at 3 outs.
3. **Skip Bottom 9** if the home team leads after the Top 9 (show “X” in the line score).
4. **Walk-off handling**:
   - Non-HR: clamp runs to **minimum needed to win**, then end game; `LOB = 0`.
   - HR: all runners + batter score; `LOB = 0`; end game.
5. If tied after 9, declare a **tie** (v1).

## Output (text only)
**Header**
- `AWAY @ HOME — Seed: 12345`
- Date/time stamp (local), `DH: ON`, `Extras: OFF (tie allowed)`
- If seed omitted, print `Seed: <generated>`.

**Running Line Score**
- `1 2 3 4 5 6 7 8 9 | R H E`
- Home shows “X” for skipped B9.

**Play Log (per PA)**
- Stable phrasing; no random wording. Examples:
  - `[Top 1] #1 Comet 1 vs Shark P — Single to RF. R1 to 1B.`
  - `[Top 1] #2 Comet 2 — K swinging. 1 out.`

**Team Totals**
- `Final: AWAY 3 — HOME 4`
- `R/H/E`, team LOB.

**Box Scores**
- **Batting:** `AB  R  H  RBI  BB  K  HR  LOB`
- **Pitching:** `IP  BF  H  R  ER  BB  K  HR`
- Each team lists all nine batters (order shown) and one pitcher.
- Numeric columns right-aligned.

**Footer**
- `Seed: 12345`
- `LogHash: abc123` (optional snapshot hash)

## Determinism Scope
- One RNG seeded only by `--seed` drives lineup and PA outcomes.
- No other randomness; timestamp excluded from tests.

## Modeled vs Not Modeled (v1)
- **Modeled:** K, BB, HBP, InPlayOut, 1B, 2B, 3B, HR, ROE, SF, DP, TP.
- **Not modeled:** IBB, pickoffs, balks, WP, PB, steals/CS between PAs, catcher interference.
- Phrase set fixed; no synonyms.

## Errors & Team "E"
- “E” = count of ROE events + any explicit fielding errors emitted (e.g., E6 on advances).
- If none emitted, `E = ROE`.

## Box Score Definitions
- **Batting:** AB excludes BB/HBP/SF. RBI rules: ROE 0; BL BB/HBP 1; SF 1; HR all; walk-off clamp.
- **Pitching:** IP in thirds (.0/.1/.2), BF = batters faced, ER excludes runs due to errors, H excludes ROE.
- No W/L/S/BS in v1.

## Walk-off Acceptance
- Non-HR: clamp to minimum needed; no further advances; LOB = 0; end game.
- HR: all runners + batter score; LOB = 0; end game.

## Output Formatting
- Line score always 9 columns; home “X” if skipped B9.
- Batters listed in order; one pitcher line per team.
- Numeric columns right-aligned; names left-aligned.

## LogHash
- SHA-256 over normalized play-log lines only (no header, timestamp, totals, boxes).
- Emit as `LogHash: <hex>`.

---

## Acceptance Checklist (for the PRD Roo will output)
- The PRD contains **no source code** or implementation details.
- All sections listed under **Deliverable** are present.
- Ambiguities are captured under **Open Questions**.
- Acceptance criteria are testable and map to the Output shape above.

